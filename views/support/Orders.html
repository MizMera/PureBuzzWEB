<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Ratings</title>
    <!-- Link to Bootstrap CSS -->
    <link rel="stylesheet" href="style.css">
    <!-- Link to Font Awesome (for icons) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .product-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            background-color: #f8f9fa;
            text-align: center;
        }

        .product-image {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .product-name {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .product-price {
            font-size: 1.2rem;
            color: #555;
            margin-bottom: 15px;
        }

        .rating i {
            font-size: 1.8rem;
            color: #ccc;
            cursor: pointer;
        }

        .rating i.selected {
            color: gold;
        }

        .comment-box {
            width: 100%;
            font-size: 1rem;
            height: 100px;
            padding: 10px;
            margin-top: 10px;
            resize: none;
        }
    </style>
</head>

<body>
    <div style="margin-top: 100px;" class="d-flex">
        <!-- Sidebar -->
        <nav class="sidebar">
            <ul class="nav">
                <li class="nav-item nav-category">Products and Management</li>
                <li class="nav-item">
                    <a class="nav-link" href="index.php" aria-expanded="false" aria-controls="form-elements">
                        <span class="menu-title">Product&categorie</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="collapse" href="#tables" aria-expanded="false"
                        aria-controls="tables">
                        <i class="menu-icon mdi mdi-table"></i>
                        <span class="menu-title">Categories</span>
                    </a>
                    <div class="collapse" id="tables">
                        <ul class="nav flex-column sub-menu">
                            <li class="nav-item">
                                <a class="nav-link" href="pages/tables/basic-table.html">Basic table</a>
                            </li>
                        </ul>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../index.php? " aria-expanded="false" aria-controls="charts">
                        <i class="menu-icon mdi mdi-chart-line"></i>
                        <span class="menu-title">Product</span>
                    </a>
                    <div class="collapse" id="charts">
                        <ul class="nav flex-column sub-menu">
                            <li class="nav-item">
                                <a class="nav-link" href="pages/charts/chartjs.html">ChartJs</a>
                            </li>
                        </ul>
                    </div>
                </li>
                <li class="nav-item nav-category">Support</li>
                <li class="nav-item">
                    <a class="nav-link" href="#" aria-expanded="false" aria-controls="charts">
                        <i class="menu-icon mdi mdi-chart-line"></i>
                        <span class="menu-title">Submit a claim</span>
                    </a>
                    <div class="collapse" id="charts">
                        <ul class="nav flex-column sub-menu">
                            <li class="nav-item">
                                <a class="nav-link" href="pages/charts/chartjs.html">ChartJs</a>
                            </li>
                        </ul>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="help.html" aria-expanded="false" aria-controls="charts">
                        <i class="menu-icon mdi mdi-chart-line"></i>
                        <span class="menu-title">help</span>
                    </a>
                    <div class="collapse" id="charts">
                        <ul class="nav flex-column sub-menu">
                            <li class="nav-item">
                                <a class="nav-link" href="pages/charts/chartjs.html">ChartJs</a>
                            </li>
                        </ul>
                    </div>
                </li>
            </ul>
        </nav>
        <div class="container py-">
            <h1 class="text-center mb-4">Rate Our Products</h1>
            <div class="row">
                <!-- Product 1 -->
                <div class="col-md-4">
                    <div class="product-card">
                        <img src="shampooing.png" alt="Shampooing" class="product-image">
                        <div class="product-name">Shampooing</div>
                        <div class="product-price">$15.99</div>
                        <div>
                            <label>Rate this product:</label>
                            <div class="rating" data-product-id="101">
                                <i class="fa fa-star" data-value="1"></i>
                                <i class="fa fa-star" data-value="2"></i>
                                <i class="fa fa-star" data-value="3"></i>
                                <i class="fa fa-star" data-value="4"></i>
                                <i class="fa fa-star" data-value="5"></i>
                            </div>
                        </div>
                        <textarea class="form-control comment-box" rows="4"
                            placeholder="Write your comment here..."></textarea>
                        <button class="btn btn-primary btn-sm mt-3 submit-button">Submit</button>
                    </div>
                </div>

                <!-- Product 2 -->
                <div class="col-md-4">
                    <div class="product-card">
                        <img src="Huile.png" alt="Huile et Bomme a Levres" class="product-image">
                        <div class="product-name">Huile et Bomme a Levres</div>
                        <div class="product-price">$89.99</div>
                        <div>
                            <label>Rate this product:</label>
                            <div class="rating" data-product-id="102">
                                <i class="fa fa-star" data-value="1"></i>
                                <i class="fa fa-star" data-value="2"></i>
                                <i class="fa fa-star" data-value="3"></i>
                                <i class="fa fa-star" data-value="4"></i>
                                <i class="fa fa-star" data-value="5"></i>
                            </div>
                        </div>
                        <textarea class="form-control comment-box" rows="4"
                            placeholder="Write your comment here..."></textarea>
                        <button class="btn btn-primary btn-sm mt-3 submit-button">Submit</button>
                    </div>
                </div>

                <!-- Product 3 -->
                <div class="col-md-4">
                    <div class="product-card">
                        <img src="Sabon.png" alt="Sabon" class="product-image">
                        <div class="product-name">Sabon</div>
                        <div class="product-price">$199.99</div>
                        <div>
                            <label>Rate this product:</label>
                            <div class="rating" data-product-id="103">
                                <i class="fa fa-star" data-value="1"></i>
                                <i class="fa fa-star" data-value="2"></i>
                                <i class="fa fa-star" data-value="3"></i>
                                <i class="fa fa-star" data-value="4"></i>
                                <i class="fa fa-star" data-value="5"></i>
                            </div>
                        </div>
                        <textarea class="form-control comment-box" rows="4"
                            placeholder="Write your comment here..."></textarea>
                        <button class="btn btn-primary btn-sm mt-3 submit-button">Submit</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Handle star rating
        document.querySelectorAll('.rating').forEach(ratingElement => {
            const stars = ratingElement.querySelectorAll('.fa-star');

            stars.forEach(star => {
                star.addEventListener('click', () => {
                    const value = star.getAttribute('data-value');

                    // Reset all stars
                    stars.forEach(s => s.classList.remove('selected'));

                    // Highlight up to the clicked star
                    for (let i = 0; i < value; i++) {
                        stars[i].classList.add('selected');
                    }

                    // Store the selected rating in the dataset
                    ratingElement.setAttribute('data-selected-rating', value);
                });
            });
        });

        document.querySelectorAll('.rating').forEach(ratingElement => {
            const stars = ratingElement.querySelectorAll('.fa-star');

            stars.forEach(star => {
                star.addEventListener('click', () => {
                    const value = star.getAttribute('data-value');

                    // Reset all stars
                    stars.forEach(s => s.classList.remove('selected'));

                    // Highlight up to the clicked star
                    for (let i = 0; i < value; i++) {
                        stars[i].classList.add('selected');
                    }

                    // Store the selected rating in the dataset
                    ratingElement.setAttribute('data-selected-rating', value);
                });
            });
        });

        // Handle comment submission
        document.querySelectorAll('.submit-button').forEach(button => {
            button.addEventListener('click', async function () {
                const productCard = this.closest('.product-card');
                const productName = productCard.querySelector('.product-name').innerText;
                const commentTextarea = productCard.querySelector('.comment-box');
                const ratingElement = productCard.querySelector('.rating');
                const selectedRating = ratingElement.getAttribute('data-selected-rating');
                const comment = commentTextarea.value;

                if (!selectedRating || !comment) {
                    alert("Please provide both a rating and a comment before submitting.");
                    return;
                }

                // Prepare data to be sent
                const feedbackData = {
                    product_name: productName, // Use product name for demonstration
                    comment: comment,
                    rating: selectedRating,
                };

                try {
                    // Send data to the server via POST request
                    const response = await fetch('http://localhost/omar/public/index.php?controller=orders&action=storeFeedback', {  // Make sure to correct the URL
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(feedbackData)
                    });

                    const result = await response.json();

                    if (response.ok) {
                        alert(result.message); // Success message from the server
                        // Clear the comment and reset the stars
                        commentTextarea.value = '';
                        ratingElement.querySelectorAll('.fa-star').forEach(star => star.classList.remove('selected'));
                    } else {
                        alert(result.error); // Error message from the server
                    }
                } catch (error) {
                    console.error("An error occurred while submitting feedback:", error);
                    alert("Failed to submit feedback. Please try again later.");
                }
            });
        });
    </script>
</body>

</html>